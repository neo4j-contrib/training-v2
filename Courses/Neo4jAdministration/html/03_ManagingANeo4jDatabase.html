<html>
   <head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1192232-34"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-1192232-34');
      </script>
      <meta charset="utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
      <title>Neo4j GraphAcademy: Neo4j Administration</title>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/docbook.css"></link>
      <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,300italic"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/extra.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/chunked-base.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/console.css"></link>
      <style type="text/css">
        ul.documentation-library>li>a {
          margin-left: 10px !important;
          margin-right: 10px !important;
        }
        @media only screen and (max-width: 1350px) {
          #helplink {
            display: none;
          }
        }
      </style>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script>
      <link rel="shortcut icon" href="https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico"></link>
      <script type='text/javascript' src='https://neo4j.com/wp-content/themes/neo4jweb/assets/js/vendor/codemirror.min.js?ver=4.5.2'></script>
      <script type='text/javascript'>
        window.trainingPartName = "module-3"
        window.trainingLocalStoragePrefixKey = "com.neo4j.graphacademy.neo4jadministration."
        window.trainingQuizCount = 6
        window.trainingEnrollmentUrl = "https://neo4j.com/graphacademy/online-training/neo4j-administration-dev/"
      </script>
   </head>
   <body>
      <header style="top: 0px;">
         <a href="../part-0/" id="logo"><img src="https://neo4j.com/wp-content/themes/neo4jweb/assets/images/neo4j-logo-2015.png" alt="Neo4j Logo"></a>
         <ul class="documentation-library">
            
            <li id="menu-module-1">
              <a href="../part-1/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">1</strong>
              </span>
              Intro to Neo4j</a>
            </li>
            <li id="menu-module-2">
              <a href="../part-2/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">2</strong>
              </span>
              Overview Of Admin</a>
            </li>
            <li id="menu-module-3">
              <a href="../part-3/" style="color: #000">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">3</strong>
              </span>
              Managing a DB</a>
            </li>
            <li id="menu-module-4">
              <a href="../part-4/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">4</strong>
              </span>
              Causal Clustering</a>
            </li>
            <li id="menu-module-5">
              <a href="../part-5/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">5</strong>
              </span>
              Security</a>
            </li>
            <li id="menu-module-6">
              <a href="../part-6/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">6</strong>
              </span>
              Monitoring</a>
            </li>
            <li id="menu-module-7">
              <a href="../part-7/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">7</strong>
              </span>
              The End</a>
            </li>
         </ul>
         <div id="helplink" style="position: absolute; top: 10px; right: 30px; font-size: 20px;">
           <a href="https://community.neo4j.com/c/general/online-training" target="_blank">Need Help?</a>
         </div>
         <nav id="header-nav">
         <span class="nav-previous">
           
              <a accesskey="p" href="../part-2/">
                <span class="fa fa-long-arrow-left" aria-hidden="true"></span>
              Admin Overview</a>
           
         </span>
         <span class="nav-current">
           <p class="nav-title" style="display: none;"></p>
         </span>
         <span class="nav-next">
           
              <a accesskey="n" href="../part-4/">Clusters
                <span class="fa fa-long-arrow-right" aria-hidden="true"></span>
              </a>
           
         </span>
         </nav>
      </header>

<script src="https://browser.sentry-cdn.com/4.4.1/bundle.min.js" crossorigin="anonymous"></script>
<script type='text/javascript'>
  var loc = window.location;
  document.write(unescape("%3Cscript src='https://munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
  window.trainingClassName = "neo4j-administration";
</script>
<script>Munchkin.init('773-GON-065');</script>
<style>
    @import "https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.css" screen;
    .modal {
        width: 775px;
        height: 775px;
        padding: 10px;
        margin: 0;
    }
    .blocker {
        height: initial;
        background-color: transparent;
    }
  a.button {
    display: block;
    text-align: center;
    width: 250px;
    font-size: 18px;
    margin-top: 50px;
    font-family: 'Open Sans';
    height: 55px;
    border-style: solid;
    border-width: 0;
    cursor: pointer;
    color: white;
    padding: 15px;
    font-weight: 300;
    background-color: #6dcc9c;
    border-color: #4ac084;
  }

  .button a hover {
      background-color: #4ac084;
  }

    a.button-notebook {
      display: block;
      text-align: center;
      width: 250px;
      font-size: 18px;
      margin-top: 20px;
      font-family: 'Open Sans';
      height: 55px;
      border-style: solid;
      border-width: 0;
      cursor: pointer;
      color: white;
      padding: 15px;
      font-weight: 300;
      background-color: #6dcc9c;
      border-color: #4ac084;
    }

    .button-notebook a hover {
        background-color: #4ac084;
    }

  pre.cypher-syntax {
    background-color: #eaf1f8;
  }
</style>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/underscore.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.js"></script>
<script src="https://neo4j.com//online_training/cypher-gadget/libs/jquery-ui.min.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.js"></script>
<script src="http://s3.amazonaws.com/dev.assets.neo4j.com/wp-content/js/js.cookie-2.1.3.min.js"></script>
<script type="text/javascript">
  Sentry.init({ dsn: 'https://652808557bb1478883636c96edb51739@sentry.io/1342352' });
</script>
<script src="https://neo4j.com/online_training/tasks.js"></script>
<script type="text/javascript">
function renderGadget(containerSelector, options) {
  if (!options.cypherSetup) return;
  var frameId = _.uniqueId("exmodal");
  $(containerSelector).append('<button onclick="setGadgetUrl(\'#' + frameId +
    '\')" rel="modal:open" class="btn">' + (options.label || 'Gadget') + '</button>');

    $(containerSelector).append(modalWindow(frameId,options));
  }

function modalWindow(frameId, options) {
   return `<div id="${frameId}" class="modal-dialog modal fade draggable" style="display:none;text-align:center;vertical-align:middle;" >
            <iframe data-src="/online_training/cypher-gadget/test.html?cypherSetup=${options.cypherSetup}&${formatTask(options)}" width="725" height="725" frameborder="0" style="margin:5px;"
              webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
           <div>`;
}

function formatTask(options) {
  if (options.task) return "cypherTaskJSON="+encodeURIComponent(JSON.stringify(options.task));
  if (options.taskName) return "cypherTask="+options.taskName;
  return "";
}

function setGadgetUrl(sel) {
  $(sel).modal();
  $(sel).draggable();
  var $iframe = $(sel).find("iframe");
  $iframe.attr("src", $iframe.data("src"));
}
</script>
<div id="developer-manual" style="padding-top: 150px; padding-left: 20px; padding-bottom: 100px;">
<h1>Managing a Neo4j Database</h1>

      <div  id="_about_this_module" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>About this module</h3>


<div class="paragraph">
<p>Now that you have installed the Neo4j Enterprise Edition, you will learn how to perform some administrative tasks with the Neo4j instance.</p>
</div>


<div class="paragraph">
<p>At the end of this module, you should be able to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Start a Neo4j instance.
</li>
<li>
Stop the Neo4j instance.
</li>
<li>
Set the password for the <em>neo4j</em> user.
</li>
<li>
Copy a Neo4j database.
</li>
<li>
Modify the location for a Neo4j database.
</li>
<li>
Check the consistency of a Neo4j database.
</li>
<li>
Create scripts for modifying a Neo4j database.
</li>
<li>
Manage plugins for a Neo4j database.
</li>
<li>
Configure ports used by the Neo4j instance.
</li>
<li>
Perform an online backup of a Neo4j database.
</li>
<li>
Create a database with the import tool.
</li>
</ul>
</div>
</div>
<div  id="_neo4j_instance_files" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Neo4j instance files</h3>


<div class="paragraph">
<p>Depending on your platform, a Neo4j instance&#8217;s files are, by default, placed as described <a href="https://neo4j.com/docs/operations-manual/3.5/configuration/file-locations/">here</a>. Here is a brief overview of the default folders you will frequently use for managing the Neo4j instance.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Purpose of folder</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Tools</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The  <strong>/usr/bin</strong> folder contains the tooling scripts you will typically run to manage the Neo4j instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Configuration</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><strong>Neo4j.conf</strong> is the primary configuration file for the Neo4j instance and resides in the <strong>/etc/neo4j</strong> folder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Logging</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The <strong>/var/log/neo4j</strong> folder contains log files that you can monitor.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Database(s)</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The <strong>/var/lib/neo4j/data</strong> folder contains the database(s).</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p></p>
</div>
</div>
<div  id="_post_installation_preparation" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Post-installation preparation</h3>


<div class="paragraph">
<p>In this training, all screenshots and examples are shown using Neo4j Enterprise Edition installed as a Debian package. If your system is different, you will need to adjust file locations as described later in this module.</p>
</div>


<div class="paragraph">
<p>When you are setting up a production environment, you want to control who can manage the Neo4j instance. You will also want to control when the Neo4j instance starts as you will performing some configuration changes and database operations that may require that the instance to be stopped.</p>
</div>


<div class="paragraph">
<p>When Neo4j is installed as a Debian package, the <em>neo4j</em> service is enabled and the Neo4j instance is automatically started. Other platforms do not start the Neo4j instance automatically.</p>
</div>
<div  id="_post_install_changing_the_neo4j_password_non_debian" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Post-install: Changing the <em>neo4j</em> password (non-Debian)</h3>


<div class="paragraph">
<p>After you install Neo4j and before you start the Neo4j instance, a best practice is to change the default password for the user <em>neo4j</em>. You do this on all platforms, except when you have installed a Debian package. You will learn about changing the <em>neo4j</em> password on Debian later in this module.</p>
</div>


<div class="paragraph">
<p>You change the password for the <em>neo4j</em> user by executing the following command:</p>
</div>


<div class="paragraph">
<p><code>[sudo] bin/neo4j-admin set-initial-password newPassword</code></p>
</div>


<div class="paragraph">
<p>where <em>newPassword</em> is a password you will remember.</p>
</div>
</div>
<div  id="_post_install_debian" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Post-install: Debian</h3>


<div class="paragraph">
<p>Initially and on Debian, you should disable <em>neo4j</em> as a service that is started automatically when the system starts. You do this with this command:</p>
</div>


<div class="paragraph">
<p><code>[sudo] systemctl disable neo4j</code></p>
</div>


<div class="paragraph">
<p>In addition, you should create the folder <strong>/var/run/neo4j</strong> that is owned by <em>neo4j:neo4j</em>. This is where the PID for the currently running Neo4j instance is placed.</p>
</div>
</div>
</div>
<div  id="_managing_the_neo4j_instance" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Managing the Neo4j instance</h3>


<div class="paragraph">
<p>When the instance is started, it creates a database named <strong>graph.db</strong> in the default location which is a folder under <strong>/var/lib/neo4j/data/databases</strong>. You can start and stop the instance regardless of whether the <em>neo4j</em> service is enabled.</p>
</div>


<div class="paragraph">
<p>You start, stop, restart, and check the status of the Neo4j instance on Debian as follows:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<code>[sudo] systemctl start neo4j</code>
</li>
<li>
<code>[sudo] systemctl stop neo4j</code>
</li>
<li>
<code>[sudo] systemctl restart neo4j</code>
</li>
<li>
<code>[sudo] systemctl status neo4j</code>
</li>
</ul>
</div>


<div class="paragraph">
<p>You start, stop, restart and check the status of the Neo4j instance on non-Debian systems as follows:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<code>[sudo] bin/neo4j start</code>
</li>
<li>
<code>[sudo] bin/neo4j stop</code>
</li>
<li>
<code>[sudo] bin/neo4j restart</code>
</li>
<li>
<code>[sudo] bin/neo4j status</code>
</li>
</ul>
</div>


<div class="paragraph">
<p>When the Neo4j instance starts, it opens the database, and writes to the folders for the database and to the log file.</p>
</div>
<div  id="_checking_the_status_of_the_instance" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Checking the status of the instance</h3>


<div class="paragraph">
<p>At any time, you can check the status of the Neo4j instance.</p>
</div>


<div class="paragraph">
<p>You check the status of the instance as follows:</p>
</div>


<div class="paragraph">
<p><code>systemctl status neo4j</code></p>
</div>


<div class="paragraph">
<p>Here is an example where we check the status of the Neo4j instance:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Neo4jStatus-Debian.png" alt="Neo4jStatus-Debian" width="800">
</p>
</div>


<div class="paragraph">
<p>Here we see that the instance is started. Notice that the service is disabled as well.
After the instance is started you can identify the process ID (Main PID) from the status command on Debian. It is sometimes helpful to know the process ID of the Neo4j instance (JVM) in the event that it is unresponsive and you must kill it.</p>
</div>


<div class="paragraph">
<p>However, knowing whether the instance is started (active) is generally not sufficient, especially if you have made some configuration changes. You can view details of the Neo4j instance by examining the log file.</p>
</div>
</div>
<div  id="_viewing_the_neo4j_log" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Viewing the neo4j log</h3>


<div class="paragraph">
<p>The status command gives you a short glimpse of the status of the Neo4j instance. In some cases, although the instance is <em>active</em>, it may not have started successfully. You may want to examine more information about the instance, such as the folders it is using at runtime and information about activity against the instance, and especially if any errors occurred during startup. As an administrator, you should become familiar with the types of records that are written to the log files for the Neo4j instance.</p>
</div>


<div class="paragraph">
<p>You can view the log file for the instance on Debian as follows:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<code>journalctl -u neo4j</code>  to view the entire neo4j log file.
</li>
<li>
<code>journalctl -e -u neo4j</code> to view the end of the neo4j log file.
</li>
<li>
<code>journalctl -u neo4j -b &gt; neo4j.log</code> where you can view <strong>neo4j.log</strong> in an editor.
</li>
</ul>
</div>


<div class="paragraph">
<p>Here is the result from <code>journalctl</code>:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/FirstNeo4jLog-Debian.png" alt="FirstNeo4jLog-Debian" width="800">
</p>
</div>


<div class="paragraph">
<p>When the Neo4j instance starts, you can also confirm that it is started by seeing the <em>Started</em> record in the log file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
You can also view the log file in the <strong>logs</strong> folder on all platforms.
</td>
</tr>
</table>
</div>
</div>
<div  id="_exercise_1_managing_the_neo4j_instance" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #1: Managing the Neo4j instance</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will stop and start the Neo4j instance and view its status and log file.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>


<div class="paragraph">
<p>You should disable the <em>neo4j</em> service <code>[sudo] systemctrl disable neo4j</code>, if you are using a system that utilizes the <em>neo4j</em> service (for example, Debian).</p>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Open a terminal on your system.
</li>
<li>
View the status of the Neo4j instance.
</li>
<li>
Stop the Neo4j instance.
</li>
<li>
View the status of the Neo4j instance.
</li>
<li>
Examine the Neo4j log file.
</li>
<li>
Examine the files and folders created for this Neo4j instance.
</li>
</ol>
</div>
</div>
</div>
<div  id="_using_cypher_shell" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Using <code>cypher-shell</code></h3>


<div class="paragraph">
<p><code>cypher-shell</code> enables you to access the Neo4j database from a terminal window.  You simply log into the database using <code>cypher-shell</code> with your credentials:</p>
</div>


<div class="paragraph">
<p><code>/usr/bin/cypher-shell -u &lt;username&gt; -p &lt;password&gt;</code></p>
</div>


<div class="paragraph">
<p>Once authenticated, you enter Cypher statements to execute just as you would in a Neo4j Browser session. One caveat with <code>cypher-shell</code>, however is that all Cypher commands <span class="underline">must</span> end with <code>;</code>. You exit <code>cypher-shell</code> with the command <code>:exit</code>.</p>
</div>
<div  id="_example_using_cypher_shell" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Example: Using <code>cypher-shell</code></h3>


<div class="paragraph">
<p>Here is an example showing that we can successfully log in to the database for the Neo4j instance, providing the default credentials <em>neo4j/neo4j</em>:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/InitialCypherShellLogin-Debian.png" alt="InitialCypherShellLogin-Debian" width="800">
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
If you set the environment variables NEO4J_USER and NEO4J_PASSWORD with their respective values, then you need not enter your credentials when logging into <code>cypher-shell</code>.
</td>
</tr>
</table>
</div>
</div>
<div  id="_changing_the_default_password_debian_only" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Changing the default password (Debian only)</h3>


<div class="paragraph">
<p>If we were to attempt to access the database for the first time, we would receive an error. This is because the default credentials <em>neo4j/neo4j</em> <span class="underline">must</span> be changed. As an administrator, you want to control who can manage this Neo4j instance and its database. To do so, you change the default password for the <em>neo4j</em> user. Later in this training, you will learn more about securing Neo4j by managing users and their access.</p>
</div>


<div class="paragraph">
<p>While logged into the database in <code>cypher-shell</code>, you execute the procedure to change the password:</p>
</div>


<div class="paragraph">
<p><code>CALL dbms.changePassword('newPassword');</code></p>
</div>


<div class="paragraph">
<p>In this example, we log into <code>cypher-shell</code> with our credentials. Then we execute the Cypher command to change the password. Finally, we specify <code>:exit</code> to log out of <code>cypher-shell</code>.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ChangePassword-Debian.png" alt="ChangePassword-Debian" width="700">
</p>
</div>


<div class="paragraph">
<p>After changing the default password for the Neo4j instance (database), we are now able to access the database after logging in with the new credentials.</p>
</div>
</div>
<div  id="_accessing_the_database" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Accessing the database</h3>


<div class="paragraph">
<p>Here is an example where we execute a Cypher statement against the empty database where we list all active queries:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/CypherShellStatement-Debian.png" alt="CypherShellStatement-Debian" width="1000">
</p>
</div>


<div class="paragraph">
<p>When you are done with <code>cypher-shell</code>, you enter <code>:exit</code> to exit.</p>
</div>
</div>
<div  id="_exercise_2_using_cypher_shell_to_change_the_password" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #2: Using <code>cypher-shell</code> to change the password</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will log in to the database with <code>cypher-shell</code>, change the password for the database, and execute a Cypher statement to load the database. You can perform this Exercise regardless of the type of system you are using.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>


<div class="paragraph">
<p>You should ensure that the Neo4j instance is started.</p>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Open a terminal on your system.
</li>
<li>
Log into the database with <code>cypher-shell</code> using the default credentials of <em>neo4j/neo4j</em>. (or different credentials if you changed the password previously with )<code>neo4j-admin set-initial-password</code>)
</li>
<li>
Execute the Cypher statement, <code>CALL dbms.listQueries();</code>. Do you get an error? Note you will not get an error if you previously changed the password.
</li>
<li>
Execute the Cypher statement to change the password to something you will remember.
</li>
<li>
Exit out of <code>cypher-shell</code>.
</li>
<li>
Log into the database with <code>cypher-shell</code> using the new credentials.
</li>
<li>
Execute the Cypher statement, <code>CALL dbms.listQueries();</code>.
</li>
<li>
Exit out of <code>cypher-shell</code>.
</li>
<li>
Download this <a href="https://s3-us-west-1.amazonaws.com/data.neo4j.com/admin-neo4j/movieDB.cypher">file</a>. This file contains the Cypher statements to load the database with movie data.
</li>
<li>
Invoke <code>cypher-shell</code> sending movieDB.cypher as input. You should see something like the following:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex2-LoadMovieDB-cypher-shell.png" alt="Ex2-LoadMovieDB-cypher-shell" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="11">
<li>
The database is now populated with the <em>Movie</em> data. Log in to <code>cypher-shell</code> and execute a Cypher statement to retrieve data from the database, for example: <code>MATCH (p:Person) WHERE p.name='Tom Cruise' RETURN p.name, p.born;</code> You should see the following:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex2-RetrieveData.png" alt="Ex2-RetrieveData" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="12">
<li>
Exit <code>cypher-shell</code>.
</li>
</ol>
</div>
</div>
</div>
<div  id="_renaming_a_neo4j_database" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Renaming a Neo4j database</h3>


<div class="paragraph">
<p>By default, the Neo4j database (on Debian) is located in the <strong>/var/lib/neo4j/data/databases</strong> folder. The database is represented by a subfolder with the default name, <strong>graph.db</strong>. You should never modify, copy, or move any files or folders at or under <strong>graph.db</strong>.</p>
</div>


<div class="paragraph">
<p>A key file for a Neo4j instance is <strong>/etc/neo4j/neo4j.conf</strong>. This file contains all settings used by the Neo4j instance at runtime. Here is a portion of the default <strong>neo4j.conf</strong> file that is installed with Neo4j. The setting for the name of the database is the property <em>dbms.active_database</em>, which, by default, is <strong>graph.db</strong>. Since this is the default configuration as installed, this setting is commented out in the configuration file because Neo4j uses the default at runtime.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/DefaultNeo4jConfig.png" alt="DefaultNeo4jConfig" width="800">
</p>
</div>


<div class="paragraph">
<p>If you wanted to change the name of the Neo4j database, you could change the folder name <strong>graph.db</strong> to another name, but if you do so, you must uncomment the line in <strong>neo4j.conf</strong> for <em>dbms.active_database</em> to match what you have renamed the database folder to. You should make this type of change in the configuration when the Neo4j instance is stopped.</p>
</div>
</div>
<div  id="_deleting_a_neo4j_database" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Deleting a Neo4j database</h3>


<div class="paragraph">
<p>You would want to delete a Neo4j database for a couple of reasons:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
The database is no longer needed or usable and you want to recreate a fresh database.
</li>
<li>
The database is no longer needed and you want to remove it so that a new database can be used. To do this you would load a new database which you will learn about next in this module.
</li>
</ul>
</div>


<div class="paragraph">
<p>To delete a Neo4j database used by a Neo4j instance you must:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Stop the Neo4j instance.
</li>
<li>
Remove the folder for the active database.
</li>
</ol>
</div>


<div class="paragraph">
<p>For example, delete the <strong>graph.db</strong> database:</p>
</div>


<div class="paragraph">
<p><code>[sudo] rm -rf /var/lib/neo4j/data/databases/graph.db</code></p>
</div>


<div class="paragraph">
<p>After deleting the Neo4j database, if you were to start the Neo4j instance, it would recreate an empty database. If you want to copy an existing database for use with this Neo4j instance, you dump and load an existing database to be used as the active database. Then you can start the Neo4j instance. You will learn about dumping and loading a database next.</p>
</div>
</div>
<div  id="_copying_a_neo4j_database" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Copying a Neo4j database</h3>


<div class="paragraph">
<p>The structure of a Neo4j database is proprietary and could change from one release to another. You should <span class="underline">never</span> copy the database from one location in the filesystem/network to another location. You copy a Neo4j database by creating an offline backup.</p>
</div>


<div class="paragraph">
<p>To create an offline backup of a database that, perhaps you want to have as an additional copy or you want to give  to another user for use on their system, you must:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Stop the Neo4j instance.
</li>
<li>
Ensure that the folder where you will dump the database exists.
</li>
<li>
Use the <code>dump</code> command of the <code>neo4j-admin</code> tool to create the dump file.
</li>
<li>
You can now copy the dump file between systems.
</li>
</ol>
</div>


<div class="paragraph">
<p>Then, if you want to create a database from any offline backup file to use for a Neo4j instance, you must:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Stop the Neo4j instance.
</li>
<li>
Determine what you will call the new database and adjust <strong>neo4j.conf</strong> to use this database as the active database.
</li>
<li>
Use the <code>load</code> command of the <code>neo4j-admin</code> tool to create the database from the dump file using the same name you specify in the <strong>neo4j.conf</strong> file.
</li>
<li>
Start the Neo4j instance.
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
Dumping and loading a database is done when the Neo4j instance is stopped. Later in this module, you will learn about online backup and restore. Offline backup is typically done for initial setup and development purposes. Online backup and restore is done in a production environment.
</td>
</tr>
</table>
</div>
<div  id="_creating_and_offline_backup" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Creating and offline backup</h3>


<div class="paragraph">
<p>To create an offline backup, the Neo4j instance must be stopped.
Here is how to use the <code>dump</code> command of the  <code>neo4j-admin</code> tool to dump a database to a file:</p>
</div>


<div class="paragraph">
<p><code>[sudo] neo4j-admin dump --database=db-folder --to=db-target-folder/db-dump-file</code></p>
</div>


<div class="paragraph">
<p><em>where:</em></p>
</div>


<div class="paragraph">
<p></p>
</div>
<table class="tableblock frame-none grid-all stripes-none" style="width: 80%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>db-folder</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">is the name of the folder representing source database to be dumped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>db-target-folder</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">is the folder in the filesystem where you want to place the dumped database. This folder must exist.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>db-dump-file</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">is the name of the dump file that will be created.</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p></p>
</div>


<div class="paragraph">
<p>Here is an example where we have previously renamed the database to be <em>movie.db</em> and we have created a folder named <em>dumps</em>. We dump the <em>movie.db</em> using <code>neo4j-admin</code>:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/DumpDatabase.png" alt="DumpDatabase" width="1000">
</p>
</div>


<div class="paragraph">
<p>After the dump file, <em>movie-dump</em> is created, you can move it anywhere on the filesystem or network.</p>
</div>
</div>
<div  id="_creating_a_database_from_an_offline_backup" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Creating a database from an offline backup</h3>


<div class="paragraph">
<p>Assuming that you have a dump file to use, you must first determine what the name of the target database will be. If you use an existing database name, the <code>load</code> command, can overwrite the database. If you want to create a new database, then you specify a database name that does not already exist. To perform the <code>load</code> command, the Neo4j instance must be stopped. In addition, the user:group permissions of the files created must be <em>neo4j:neo4j</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
You must either perform the <code>load</code> operation as the <em>neo4j</em> user, or after the load, you must change the owner of all files and folders created to <em>neo4j:neo4j</em>.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p>Here is how to use the <code>load</code> command of the  <code>neo4j-admin</code> tool to load a database from a file:</p>
</div>


<div class="paragraph">
<p><code>[sudo] neo4j-admin load --from=path/db-dump-file --database=db-folder [--force=true]</code></p>
</div>


<div class="paragraph">
<p><em>where:</em></p>
</div>


<div class="paragraph">
<p></p>
</div>
<table class="tableblock frame-none grid-all stripes-none" style="width: 80%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>path</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">is a folder in the filesystem where the dump file resides.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>db-dump-file</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">is the file previously created with the <code>dump</code> command of <code>neo4j-admin</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>db-folder</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">is the name of the database that will be created. The database is overwritten if --force is specified as <code>true</code>.</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p></p>
</div>


<div class="paragraph">
<p>Here is an example where we load the contents of <strong>movie-dump</strong> into a database named <strong>movie2.db</strong>.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/LoadDatabase.png" alt="LoadDatabase" width="1000">
</p>
</div>
<div  id="_modifying_config_for_new_database" class="sect3 "  >
<h4>Modifying config for new database</h4>


<div class="paragraph">
<p>In order to access this newly created and loaded database, we must modify <strong>neo4j.conf</strong> to use <strong>movie2.db</strong> as the active database before starting the Neo4j instance:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Movie2ActiveDatabase.png" alt="Movie2ActiveDatabase" width="1000">
</p>
</div>


<div class="paragraph">
<p>In addition, we must change the owner:group for the database folder and its sub-folders to <em>neo4j:neo4j</em> before we start the Neo4j instance.</p>
</div>


<div class="paragraph">
<p>A best practice is to examine the log file for the Neo4j instance after you have made any configuration changes to ensure that the instance starts with no errors.</p>
</div>
</div>
</div>
<div  id="_exercise_3_copying_a_database" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #3: Copying a database</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will make a copy of your active database that has the movie data in it and use the dump file to create a database.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>


<div class="paragraph">
<p>You should have loaded the <strong>graph.db</strong> database with the movie data (Exercise #2) and stopped the Neo4j instance.</p>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Open a terminal on your system.
</li>
<li>
Create a folder named <strong>/usr/local/work</strong>.
</li>
<li>
Use the <code>neo4j-admin</code> script to dump the <strong>graph.db</strong> database to the <strong>work</strong> folder. You should do something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex3-movie-dump.png" alt="Ex3-movie-dump" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="4">
<li>
Notice that this dump file is simply a file that can be copied to any location.
</li>
<li>
Delete the <strong>graph.db</strong> database by removing the <strong>graph.db</strong> folder and its subfolders.
</li>
<li>
Use the <code>neo4j-admin</code> script to load the database from the dump file you just created. Name the database <strong>movie.db</strong>.  You should do something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex3-movie-load.png" alt="Ex3-movie-load" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="7">
<li>
Modify <strong>neo4j.conf</strong> to use <strong>movie.db</strong> as the active database.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex3-movie-cfg.png" alt="Ex3-movie-cfg" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="8">
<li>
If you did not perform the load as the user <em>neo4j</em>, you must change the owner:group of all files and folders under <strong>movie.db</strong> to be <em>neo4j:neo4j</em>. For example, change directory to the <strong>movie.db</strong> folder and  then enter the command: <code>[sudo] chown -R neo4j:neo4j movie.db</code>
This will recursively change the owner and group to all files and folders including and under the <strong>movie.db</strong> folder.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="9">
<li>
Start the Neo4j instance.
</li>
<li>
Examine the log file to ensure that the instance started with no errors.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="11">
<li>
Access the database using <code>cypher-shell</code>. Can you see the movie data in the database?
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex3-AccessDB.png" alt="Ex3-AccessDB" width="800">
</p>
</div>
</div>
</div>
<div  id="_modifying_the_location_of_the_database" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Modifying the location of the database</h3>


<div class="paragraph">
<p>If you do not want the database used by the Neo4j instance to reside in the same location as the Neo4j installation, you can modify its location in the <strong>neo4j.conf</strong> file. If you specify a new location for the data, it must exist in the filesystem and the folder must be owned by <em>neo4j:neo4j</em>.</p>
</div>


<div class="paragraph">
<p>Here we have specified a new location for the data in the configuration file:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ModifyDataLocation.png" alt="ModifyDataLocation" width="800">
</p>
</div>
<div  id="_starting_neo4j_instance_with_a_new_location" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Starting Neo4j instance with a new location</h3>


<div class="paragraph">
<p>We ensure that the location for the data exists and then we can start the Neo4j instance. If this is the first time Neo4j has been started for this location, a new database named <strong>graph.db</strong> will be created. This is because we are using the default database name in the configuration file.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/UsingNewDataLocation.png" alt="UsingNewDataLocation" width="800">
</p>
</div>


<div class="paragraph">
<p>If you have an existing database that you want to reside in a different location for the Neo4j instance, remember that you must dump and load the database to safely copy it to the new location.</p>
</div>
</div>
<div  id="_using_a_different_location_for_the_database" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Using a different location for the database</h3>


<div class="paragraph">
<p>If you are starting the Neo4j instance with a new location and do not want to use the default <strong>graph.db</strong> database, you must follow these steps to ensure that the folders for the database are set up properly:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Specify the new location in the configuration file, but do not specify the active database name.
</li>
<li>
Start or restart the Neo4j instance. A new <strong>graph.db</strong> folder will be created as well as the <strong>dbms</strong> folder required by the instance (contains important authentication information).
</li>
<li>
Examine the log file to ensure that it started without errors.
</li>
<li>
Stop the Neo4j instance.
</li>
<li>
Specify the name of the active database in the configuration file.
</li>
<li>
Load the data into the database name that will be the active database.
</li>
<li>
Ensure that the database folder and its subfolders are owned by  <em>neo4j:neo4j</em>.
</li>
<li>
Start the Neo4j instance.
</li>
<li>
Examine the log file to ensure it started without errors.
</li>
<li>
Optionally, you can remove the <strong>graph.db</strong> folder as you will be working with a different database you loaded.
</li>
</ol>
</div>
</div>
<div  id="_exercise_4_modifying_the_location_of_the_database" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #4: Modifying the location of the database</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will set up a different location for the database in your local filesystem and start the Neo4j instance using the database at this new location.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
You should have created the dump file for the movie database (Exercise #3).
</li>
<li>
Stop the Neo4j instance.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Open a terminal on your system.
</li>
<li>
Create a folder named <strong>/usr/local/data</strong>. This is the folder where the database will reside which is different from the default location used by Neo4j.
</li>
<li>
Make sure that this <strong>data</strong> folder is owned by <em>neo4j:neo4j</em>. For example, navigate to the <strong>/usr/local</strong> folder and enter <code>[sudo ]chown neo4j:neo4j data</code>.
</li>
<li>
Modify the <strong>neo4j.conf</strong> file to use <strong>/usr/local/data</strong> as the data directory. Also ensure that there is no active database specified. Your <strong>neo4j.conf</strong> file should look something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex4-LocationConfig.png" alt="Ex4-LocationConfig" width="900">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="5">
<li>
Start the Neo4j instance.
</li>
<li>
Examine the log file to ensure that the instance started without errors.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="7">
<li>
Examine the files in the <strong>/usr/local/data</strong> location. The instance should have created the <strong>databases</strong> and <strong>dbms</strong> folders. They should look as follows:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex4-LocationInUse.png" alt="Ex4-LocationInUse" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="8">
<li>
Stop the Neo4j instance.
</li>
<li>
Modify the <strong>neo4j.conf</strong> file to use <strong>movie3.db</strong> as the active database. Your <strong>neo4j.conf</strong> file should look something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex4-ActiveDatabase.png" alt="Ex4-ActiveDatabase" width="900">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="10">
<li>
Use the <code>neo4j-admin</code> script to load the database from the dump file you created in Exercise 3. Name the database <strong>movie3.db</strong> You should do something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex4-LoadDB.png" alt="Ex4-LoadDB" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="11">
<li>
Ensure that all files and folders including and under <strong>movie3.db</strong> are owned by <em>neo4j:neo4j</em>. For example, change directory to the <strong>databases</strong> folder and  then enter the command: <code>[sudo] chown -R neo4j:neo4j movie3.db</code> This will recursively change the owner and group to all files and folders under <strong>movie3.db</strong>.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="12">
<li>
Start the Neo4j instance.
</li>
<li>
Examine the log file to ensure that no errors occurred.
</li>
<li>
Access the database using <code>cypher-shell</code>. Do you get an authentication error?  This is because the database is now located in a different location and the default credentials of <em>neo4j/neo4j</em> are used.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex4-Access.png" alt="Ex4-Access" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="15">
<li>
Enter the Cypher statement to change the password: <code>CALL dbms.changePassword('newPassword');</code>
</li>
<li>
Enter a Cypher statement to retrieve some data: <code>MATCH (p:Person) WHERE p.name='Meg Ryan' RETURN p.name, p.born;</code>
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="17">
<li>
Exit <code>cypher-shell</code>.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex4-Access2.png" alt="Ex4-Access2" width="700">
</p>
</div>
</div>
</div>
<div  id="_checking_the_consistency_of_a_database" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Checking the consistency of a database</h3>


<div class="paragraph">
<p>A database&#8217;s consistency could be compromised if a software or hardware failure has occurred that affects the Neo4j instance. You will learn later in this module about live backups, but if you have reason to believe that a specific database has been corrupted,  you can perform a consistency check on it.</p>
</div>


<div class="paragraph">
<p>The Neo4j instance must be stopped to perform the consistency check.</p>
</div>


<div class="paragraph">
<p>Here is how you use the <code>neo4j-admin</code> tool to check the consistency of the database:</p>
</div>


<div class="paragraph">
<p><code>[sudo] neo4j-admin check-consistency --database=db-name --report-dir=report-location [--verbose=true]</code></p>
</div>


<div class="paragraph">
<p>The database named <em>db-name</em> is found in the data location specified in <strong>neo4j.conf</strong> file. If the tool comes back with no error, then the database is consistent. Otherwise, an error is returned and a report is written to <em>report-location</em>. You can specify verbose reporting. See the <a href="https://neo4j.com/docs/operations-manual/3.5/tools/consistency-checker/">Neo4j Operations Manual</a> for more options. For example, you can check the consistency of a backup which is a best practice.</p>
</div>


<div class="paragraph">
<p>Suppose we had loaded the <strong>movie4.db</strong> database with <code>neo4j-admin</code>. Here is what a successful run of the consistency checker should produce:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ConsistentPassed.png" alt="ConsistentPassed" width="1000">
</p>
</div>


<div class="paragraph">
<p>No report is written to the reports folder because the consistency check passed.</p>
</div>
<div  id="_inconsistencies_found" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Inconsistencies found</h3>


<div class="paragraph">
<p>Here is an example of what an unsuccessful run of the consistency checker should produce:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Inconsistencies.png" alt="Inconsistencies" width="1000">
</p>
</div>


<div class="paragraph">
<p>If inconsistencies are found, a report is generated and placed in the folder specified for the report location.</p>
</div>


<div class="paragraph">
<p>Inconsistencies in a database are a serious matter that should be looked into with the help of Neo4j Technical Support.</p>
</div>
</div>
<div  id="_exercise_5_checking_consistency_of_a_database" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #5: Checking consistency of a database</strong></h3>


<div class="paragraph">
<p>In this Exercise, you check the consistency of a database that is consistent. Then you modify a file that causes the database to become corrupt and then check its consistency.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
You should have created and started the <strong>movie3.db</strong> database (Exercise #4).
</li>
<li>
Stop the Neo4j instance.
</li>
<li>
Create a folder named <strong>/usr/local/work/reports</strong>.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Open a terminal on your system.
</li>
<li>
Run the consistency check tool on <strong>movie3.db</strong> using <code>neo4j-admin</code> specifying <strong>reports</strong> as the folder where the report will be written. The consistency check tool should return the following:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex5-Consistent.png" alt="Ex5-Consistent" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Modify the Neo4j configuration to use a database named <strong>movie3-copy.db</strong>, rather than <strong>movie3.db</strong>.
</li>
<li>
Use <code>neo4j-admin</code> to create and load <strong>movie3-copy.db</strong> from the movie dump file you created earlier.
</li>
<li>
Ensure that the owner of the <strong>movie3-copy.db</strong> is <em>neo4j:neo4j</em>.
</li>
<li>
Next, you will corrupt the database. Modify the file <strong>movie3-copy.db/neostore.nodestore.db</strong> by adding some text to the file.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="7">
<li>
Run the consistency check tool on <strong>movie3-copy.db</strong> using <code>neo4j-admin</code> specifying <strong>/usr/local/work/reports</strong> as the folder where the report will be written. The consistency check tool should return something like the following:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex5-Inconsistent.png" alt="Ex5-Inconsistent" width="1000">
</p>
</div>
</div>
</div>
<div  id="_scripting_with_cypher_shell" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Scripting with cypher-shell</h3>


<div class="paragraph">
<p>As a database administrator, you may need to automate changes to the database. The most common types of changes that administrators may want to perform are operations such as adding/dropping constraints or indexes. Note that you will need to work with the developers and architects of your application to determine what indexes must be created. You can create scripts that forward the Cypher statements to <code>cypher-shell</code>.  The number of supporting script files you create will depend upon the tasks you want to perform against the database.</p>
</div>
<div  id="_examples_adding_constraints" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Examples: Adding constraints</h3>


<div class="paragraph">
<p>Suppose that we use <em>bash</em>. We create 3 files:</p>
</div>


<div class="paragraph">
<p><strong>1. AddConstraints.cypher</strong> that contains the Cypher statements to execute in <code>cypher-shell</code>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>CREATE CONSTRAINT ON (m:Movie) ASSERT m.title IS UNIQUE;
CREATE CONSTRAINT ON (p:Person) ASSERT p.name IS UNIQUE;
CALL db.constraints();</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>Each Cypher statement must end with a <code>;</code>.</p>
</div>


<div class="paragraph">
<p><strong>2. AddConstraints.sh</strong> that invokes <code>cypher-shell</code> using a set of Cypher statements and specifies verbose output:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>cat /usr/local/work/AddConstraints.cypher | /usr/bin/cypher-shell -u neo4j -p training-helps --format verbose</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p><strong>3. PrepareDB.sh</strong> that initializes the log file, <strong>PrepareDB.log</strong>, and calls the script to add the constraints:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>rm -rf /usr/local/work/PrepareDB.log
/usr/local/work/AddConstraints.sh 2&gt;&amp;1 &gt;&gt; /usr/local/work/
PrepareDB.log
# Other scripts here</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>When the <strong>PrepareDB.sh</strong> script runs its scripts, all output will be written to the log file, including error output. Then you can simply check the log file to make sure it ran as expected.</p>
</div>
</div>
<div  id="_exercise_6_scripting_changes_to_the_database" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #6: Scripting changes to the database</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will gain experience scripting with <code>cypher-shell</code>. You will create three files in the <strong>/usr/local/work</strong> folder:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
<strong>AddConstraints.cypher</strong>
</li>
<li>
<strong>AddConstraints.sh</strong>
</li>
<li>
<strong>MaintainDB.sh</strong>
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Remove the <strong>databases/movie3-copy.db</strong> folder as this database is now corrupt.
</li>
<li>
Ensure that the Neo4j configuration uses <strong>movie3.db</strong> for the database.
</li>
<li>
Start or restart the Neo4j instance.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Open a terminal on your system.
</li>
<li>
Start <code>cypher-shell</code>, providing the credentials for the <em>neo4j</em> user.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex6-StartCypher-shell.png" alt="Ex6-StartCypher-shell" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Enter some simple Cypher statements to confirm that you can access the database. For example:
<div class="olist loweralpha">
<ol style="margin-left: 2.4rem;" class="loweralpha" type="a">
<li>
<code>CALL db.schema();</code>
</li>
<li>
<code>CALL db.constraints();</code>
</li>
</ol>
</div>
</li>
<li>
Exit Cypher-shell by typing <code>:exit</code>.
</li>
<li>
Create a Cypher script in the <strong>/usr/local/work</strong> folder named <strong>AddConstraints.cypher</strong> with the following statements:
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>CREATE CONSTRAINT ON (m:Movie) ASSERT m.title IS UNIQUE;
CREATE CONSTRAINT ON (p:Person) ASSERT p.name IS UNIQUE;</pre>
</div>
</div>
<!--
data-lang={language} class=
-->
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="6">
<li>
Create a shell script in the <strong>/usr/local/work</strong> folder named <strong>AddConstraints.sh</strong> that will forward <strong>AddConstraints.cypher</strong> to <code>cypher-shell</code>. This file should have the following contents:
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>cat /usr/local/work/AddConstraints.cypher | /usr/bin/cypher-shell -u neo4j -p training-helps --format verbose</pre>
</div>
</div>
<!--
data-lang={language} class=
-->
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="7">
<li>
Create a shell script in the <strong>/usr/local/work</strong> folder named <strong>MaintainDB.sh</strong> that will initialize the log file and then call <strong>AddConstraints.sh</strong>. This file should have the following contents:
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>rm -rf /usr/local/work/MaintainDB.log
/usr/local/work/AddConstraints.sh 2&gt;&amp;1 &gt;&gt; /usr/local/work/MaintainDB.log</pre>
</div>
</div>
<!--
data-lang={language} class=
-->
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="8">
<li>
Ensure that the scripts you created have execute permissions.
</li>
<li>
Run the <strong>MaintainDB.sh</strong> script and  view the log file.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex6-RunMaintainDB.png" alt="Ex6-RunMaintainDB" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="10">
<li>
Confirm that it created the constraints in the database. (Check using cypher-shell (<code>CALL db.constraints();</code>))
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex6-ConfirmConstraints.png" alt="Ex6-ConfirmConstraints" width="1000">
</p>
</div>
</div>
</div>
<div  id="_managing_plugins" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Managing plugins</h3>


<div class="paragraph">
<p>Some applications can use Neo4j out-of-the-box, but many applications require additional functionality that could be:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
A library supported by Neo4j such as GraphQL or GRAPH ALGORITHMS.
</li>
<li>
A community-supported library, such as APOC.
</li>
<li>
Custom functionality that has been written by the developers of your application.
</li>
</ul>
</div>


<div class="paragraph">
<p>We refer to this additional functionality as a <em>plugin</em> that contains specific procedures. A <em>plugin</em> is typically specific to a particular release of Neo4j. In many cases, if you upgrade to a later version of Neo4j, you may also need to install a new <em>plugin</em>. First, you should understand how to view the procedures available for use with the Neo4j instance. You do so by executing the Cypher statement <code>CALL db.procedures();</code>.</p>
</div>
<div  id="_retrieving_available_procedures" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Retrieving available procedures</h3>


<div class="paragraph">
<p>Here is an example of a script you can run to produce a file, <strong>Procedures.txt</strong> that contain the names of the procedures currently available for the Neo4j instance:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>echo "CALL dbms.procedures() YIELD name;" | /usr/bin/cypher-shell -u neo4j -p training-helps --format plain &gt; /usr/local/work/Procedures.txt</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>This script calls <code>dbms.procedures()</code> to return the name of each procedure in the list returned.</p>
</div>


<div class="paragraph">
<p>Here is a view of <strong>Procedures.txt</strong>:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/DefaultProcedures.png" alt="DefaultProcedures" width="800">
</p>
</div>


<div class="paragraph">
<p>By default, the procedures available to the Neo4j instance are the built-in procedures that are named db.* and dbms.*.</p>
</div>
</div>
<div  id="_adding_a_plugin_to_the_neo4j_instance" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Adding a plugin to the Neo4j instance</h3>


<div class="paragraph">
<p>To add a plugin to your Neo4j instance, you must first obtain the <strong>.jar</strong> file. It is important to confirm that the <strong>.jar</strong> file you will use is compatible with the version of Neo4j that you are using. For example, a plugin released for release 3.4 of Neo4j can be used by a Neo4j 3.5 instance, but the converse may not be true. You must check with the developers of the plugin for compatibility.</p>
</div>


<div class="paragraph">
<p>Some plugins require a configuration change. You should understand the configuration changes required for any plugin you are installing.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
When you install Neo4j, the <strong>plugins</strong> folder contains a <strong>README.txt</strong> folder that contains instructions related to sandboxing and whitelisting. These instructions will change in future releases of Neo4j.
</td>
</tr>
</table>
</div>
<div  id="_sandboxing_and_whitelisting" class="sect3 "  >
<h4>Sandboxing and whitelisting</h4>


<div class="paragraph">
<p>Neo4j provides <em>sandboxing</em> to ensure that procedures do not inadvertently use insecure APIs. For example, when writing custom code it is possible to access Neo4j APIs that are not publicly supported, and these internal APIs are subject to change, without notice.
Additionally, their use comes with the risk of performing insecure actions. The sandboxing
functionality limits the use of extensions to publicly supported APIs, which exclusively contain safe operations,
or contain security checks.</p>
</div>


<div class="paragraph">
<p>Neo4j <em>whitelisting</em> can be used to allow loading only a few extensions from a larger library.
The configuration setting <em>dbms.security.procedures.whitelist</em> is used to name certain procedures that should be
available from a library. It defines a comma-separated list of procedures that are to be loaded.
The list may contain both fully-qualified procedure names, and partial names with the wildcard *.</p>
</div>
</div>
</div>
<div  id="_example_installing_the_graph_algorithms_plugin" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Example: Installing the Graph Algorithms plugin</h3>


<div class="paragraph">
<p>Suppose we wanted to install the Graph Algorithms library that is compatible with Neo4j 3.5. We find the library in GitHub and simply download the <strong>.jar</strong> file. Here is the <a href="https://github.com/neo4j-contrib/neo4j-graph-algorithms/releases">release area</a> in GitHub for the graph algorithms library:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/GitHubGraphAlgos.png" alt="GitHubGraphAlgos" width="800">
</p>
</div>


<div class="paragraph">
<p>The main page for <a href="https://github.com/neo4j-contrib/neo4j-graph-algorithms">Graph Algorithms</a> in GitHub contains details about the plugin and instructions for installing it.</p>
</div>
<div  id="_example_download_and_ownership_of_plugin" class="sect3 "  >
<h4>Example: Download and ownership of plugin</h4>


<div class="paragraph">
<p>You download any plugins that your application will use to the /var/lib/neo4j/plugins folder:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/GraphAlgos.png" alt="GraphAlgos" width="1000">
</p>
</div>


<div class="paragraph">
<p>Ensure that the <strong>.jar</strong> file is owned by <em>neo4j:neo4j</em> and that it has execute permissions.</p>
</div>
</div>
<div  id="_example_sandboxing" class="sect3 "  >
<h4>Example: Sandboxing</h4>


<div class="paragraph">
<p>The graph algorithms plugin requires <em>sandboxing</em>.
Here is how we enable the procedures in the graph algorithms plugin. We modify the <em>Miscellaneous Configuration</em> section of the <strong>neo4j.conf</strong> file as follows:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ConfigGraphAlgos.png" alt="ConfigGraphAlgos" width="600">
</p>
</div>
</div>
<div  id="_example_restart_with_plugin" class="sect3 "  >
<h4>Example: Restart with plugin</h4>


<div class="paragraph">
<p>You must then start or restart the Neo4j instance. Once started, you can then run the script to return the names of the procedures that are available to the Neo4j instance. Here we see that we have the additional procedures for the graph algorithms plugin:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/GraphAlgosInstalled.png" alt="GraphAlgosInstalled" width="700">
</p>
</div>
</div>
</div>
<div  id="_example_installing_the_apoc_plugin" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Example: Installing the APOC plugin</h3>


<div class="paragraph">
<p><a href="https://github.com/neo4j-contrib/neo4j-apoc-procedures">APOC</a> (Awesome Procedures on Cypher) is a very popular plugin used by many applications. It contains over 450 user-defined procedures that make accessing a graph incredibly efficient and much easier than writing your own Cypher statements to do the same thing.</p>
</div>


<div class="paragraph">
<p>You obtain the plugin from the APOC <a href="https://github.com/neo4j-contrib/neo4j-apoc-procedures/releases">releases</a> page:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/APOCDownloadPage.png" alt="APOCDownloadPage" width="800">
</p>
</div>
<div  id="_example_download_and_ownership_of_plugin_2" class="sect3 "  >
<h4>Example: Download and ownership of plugin</h4>


<div class="paragraph">
<p>Here we download the <strong>.jar</strong> file, change its permissions to execute, and change the owner to be <em>neo4j:neo4j</em>.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/APOC.png" alt="APOC" width="800">
</p>
</div>
</div>
<div  id="_example_sandboxing_2" class="sect3 "  >
<h4>Example: Sandboxing</h4>


<div class="paragraph">
<p>After you have placed the <strong>.jar</strong> file into the <strong>plugins</strong> folder, you must modify the configuration for the instance as described in the main page for APOC. As described on this page, you have an option of either <em>sandboxing</em> or <em>whitelisting</em> the procedures of the plugin. How much of the APOC library is used by your application is determined by the developers so you should use them as a resource for this type of configuration change.</p>
</div>


<div class="paragraph">
<p>Suppose we want to allow <span class="underline">all</span> APOC procedures to be available to this Neo4j instance. We would sandbox the plugin in the <strong>neo4j.conf</strong> file as follows, similar to how we sandboxed the graph algorithms where we specify <code>dbms.security.procedures.unrestricted=algo.<strong>,apoc.</strong></code>.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/APOCConfig.png" alt="APOCConfig" width="600">
</p>
</div>


<div class="paragraph">
<p>Since APOC is large, you will most likely want to whitebox specific procedures so that only the procedures needed by the application are loaded into the Neo4j instance at runtime.</p>
</div>
</div>
<div  id="_example_restart_with_plugin_2" class="sect3 "  >
<h4>Example: Restart with plugin</h4>


<div class="paragraph">
<p>And here we see the results after restarting the Neo4j instance and running the script to list the procedures loaded in the instance:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/APOCLoaded.png" alt="APOCLoaded" width="600">
</p>
</div>
</div>
</div>
<div  id="_exercise_7_install_a_plugin" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #7: Install a plugin</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will install the Spatial library for use by your Neo4j instance and you will create and execute a script to report all of the procedures available to the Neo4j instance.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Stop the Neo4j instance.
</li>
<li>
Make sure you have a terminal window open for executing test commands.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
In a Web browser, go to the GitHub repository for the <a href="https://github.com/neo4j-contrib/spatial">Neo4j Spacial Library</a>.
</li>
<li>
On the main page for this repository, find the latest release of the library that is compatible with your version of Neo4j Enterprise Edition.
</li>
<li>
Download the already-built <strong>.jar</strong> file into the <strong>/var/lib/neo4j/plugins</strong> folder.
</li>
<li>
Ensure that the file size is correct and that the file name ends with <strong>.jar</strong>.
</li>
<li>
Change the owner of the <strong>.jar</strong> file to <em>neo4j:neo4j</em> and add execute permissions to the file.
</li>
<li>
Restart the Neo4j instance.
</li>
<li>
Follow the steps on the GitHub page for testing the library.
</li>
</ol>
</div>


<div class="paragraph">
<p>For example, you should see the following in the repository main page:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex7-GetSpatialLibrary.png" alt="Ex7-GetSpatialLibrary" width="800">
</p>
</div>


<div class="paragraph">
<p>Here is how you download the <strong>.jar</strong> file into the <strong>/var/lib/neo4j/plugins</strong> folder. You should confirm that the file size is correct and that the owner is <em>neo4j:neo4j</em> with execute permissions.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex7-SpatialLibrary.png" alt="Ex7-SpatialLibrary" width="800">
</p>
</div>


<div class="paragraph">
<p>Here is what you should see when you execute the first <code>curl</code> command:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex7-SpatialQuery1.png" alt="Ex7-SpatialQuery1" width="1000">
</p>
</div>


<div class="paragraph">
<p>Here is what you should see when you execute the second <code>curl</code> command:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex7-SpatialQuery2.png" alt="Ex7-SpatialQuery2" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="8">
<li>
In the <strong>/usr/local/work</strong> folder, create a script named <strong>ListProcedures.sh</strong> that will write the list of procedures available to the Neo4j instance to the <strong>/usr/local/work/Procedures.txt</strong> file.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="9">
<li>
Run the <strong>ListProcedures.sh</strong> script and examine the contents to also verify that the plugin has been installed. The <strong>Procedures.txt</strong> file should contain these items:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex7-SpatialLibraryLoaded.png" alt="Ex7-SpatialLibraryLoaded" width="600">
</p>
</div>
</div>
</div>
<div  id="_configuring_connector_ports_for_the_neo4j_instance" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Configuring connector ports for the Neo4j instance</h3>


<div class="paragraph">
<p>The Neo4j instance uses <a href="https://neo4j.com/docs/operations-manual/3.5/configuration/ports/">default port numbers</a> that may conflict with other processes on your system. The ports frequently used are the connector ports:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Name</strong></th>
<th class="tableblock halign-left valign-top"><strong>Port Number</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"> HTTP</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">7474</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Used by Neo4j Browser and REST API. It is <strong>not</strong> encrypted so it should never be exposed externally.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">7473</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Used by REST API. Requires additional SSL configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Bolt</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">7687</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Bolt connection used by Neo4j Browser, cypher-shell, and client applications.</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p></p>
</div>
<div  id="_modifying_the_default_connector_ports" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Modifying the default connector ports</h3>


<div class="paragraph">
<p>If any of these ports conflict with ports already used on your system, you can change these connector ports by modifying these property values in the <strong>neo4j.conf</strong> file:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># Bolt connector
dbms.connector.bolt.enabled=true
#dbms.connector.bolt.tls_level=OPTIONAL
#dbms.connector.bolt.listen_address=:*7687*

# HTTP Connector. There can be zero or one HTTP connectors.
dbms.connector.http.enabled=true
#dbms.connector.http.listen_address=:*7474*

# HTTPS Connector. There can be zero or one HTTPS connectors.
dbms.connector.https.enabled=true
#dbms.connector.https.listen_address=:*7473*</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>As you learn more about some of the other administrative tasks for a Neo4j instance, you will work with other ports.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
The REST API will be deprecated in Neo4j 4.0.
</td>
</tr>
</table>
</div>
</div>
<div  id="_exercise_8_modify_the_http_port" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #8: Modify the HTTP port</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will modify the default HTTP port used by the HTTP instance and use the new port.</p>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Change the HTTP port to a value that is not in use on your system, for example <strong>9999</strong>.
For example, your <strong>neo4j.conf</strong> file should look something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex8-HTTP9999.png" alt="Ex8-HTTP9999" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="2">
<li>
Restart the Neo4j instance.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Confirm that the port works by entering the following <code>curl</code> command that uses the Neo4j HTTP API to create a node, where it will ask you for the password the <em>neo4j</em> user:
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>curl -v -H "Content-Type: application/json" -d '{ "statements" : [ { "statement"  : "CREATE (n) RETURN id(n)" }]}' http://localhost:9999/db/data/transaction/commit -u neo4j</pre>
</div>
</div>
<!--
data-lang={language} class=
-->
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex8-HTTP9999-used.png" alt="Ex8-HTTP9999-used" width="1200">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="4">
<li>
Change the HTTP port back to its default (7474).
</li>
<li>
Restart the Neo4j instance.
</li>
</ol>
</div>
</div>
</div>
<div  id="_performing_online_backup_and_restore" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Performing online backup and restore</h3>


<div class="paragraph">
<p>Online backup is used in production where the application cannot tolerate the database being unavailable. In this part of the training, you will learn how to back up and restore a stand-alone Neo4j database. Later in this training, you will learn about backup and restore in a Neo4j Causal Cluster environment.</p>
</div>
<div  id="_enabling_online_backup" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Enabling online backup</h3>


<div class="paragraph">
<p>To enable a Neo4j instance to be backed up online, you must add these two properties to your <strong>neo4j.conf</strong> file:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>dbms.backup.enabled=true
dbms.backup.address=&lt;host-address&gt;:&lt;6362-6372&gt;</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>Where <em>host-address</em> is the address of a server from which you will run the backup tool from. You must specify a port number that will not conflict with existing ports used on the backup server.</p>
</div>


<div class="paragraph">
<p>A best practice for online backup of a stand-alone production database is to perform the backup on a different server. This is because the backup process and consistency checking is expensive and you want to offload this to another server.</p>
</div>


<div class="paragraph">
<p>A common practice for many enterprises is to back up their databases to Amazon S3 sites. In addition, if any backups are to be stored in S3, they should  be encrypted as well as the channel used to create send the backup to S3.</p>
</div>
</div>
<div  id="_performing_the_backup" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Performing the backup</h3>


<div class="paragraph">
<p>After you restart the Neo4j instance, you can then perform the backup on the server you specified in <em>host_address</em> as follows with consistency checking:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>neo4j-admin backup --backup-dir=&lt;backup-folder&gt;
                   --name=&lt;backup-instance-folder-name&gt;
                   --from=&lt;Neo4j-instance-host-address:&lt;port&gt;
                   --check-consistency=true
                   --cc-report-dir=&lt;report-directory&gt;</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>This will perform a full backup to <em>backup-instance-folder-name</em> for the Neo4j instance running on <em>Neo4j-instance-host-address</em>.</p>
</div>
</div>
<div  id="_restoring_from_a_backup" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Restoring from a backup</h3>


<div class="paragraph">
<p>If you need to restore a database from a backup, you must first stop the Neo4j instance. Since the instance is down, you can restore the database on the same server that runs the instance, provided the server has access to the backup location in the network.</p>
</div>


<div class="paragraph">
<p>Here is how you restore the database from a backup:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>neo4j-admin restore
          --from=&lt;absolute-path-to-backup-instance-folder-name&gt;
          --database=&lt;database-name&gt;
          --force=true</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>You specify <em>true</em> for force so that the existing database will be replaced.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
If you restore a database as <em>root</em>, make sure that you change the ownership (recursively) of the database directory to <em>neo4j:neo4j</em> before starting the Neo4j instance.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p>There are many ways for performing online backups, including incremental backups. See the <a href="https://neo4j.com/docs/operations-manual/3.5/backup/">Neo4j Operations Manual</a> for details.</p>
</div>
</div>
<div  id="_exercise_9_performing_online_backup_and_restore" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #9: Performing online backup and restore</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will perform an online backup of your database where you use the same host for the backup process. Then you will modify the database. Finally, you will restore the database from the backup.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
In your real application, if you were to back up a production stand-alone Neo4j instance, you would use a different host from the host that is running the Neo4j instance.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Stop the Neo4j instance.
</li>
<li>
Modify the Neo4j configuration so that online backup is enabled and will be done on this same host.
For example, your <strong>neo4j.conf</strong> file should look something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex9-Backup-config.png" alt="Ex9-Backup-config" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Restart the Neo4j instance.
</li>
<li>
Create a folder named <strong>/usr/local/backup</strong> and ensure that it is owned by <em>neo4j:neo4j</em>.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="5">
<li>
Perform an online backup of the active database (<strong>movie3.db</strong>).
The result of the backup should look something like this:
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex9-Backup1.png" alt="Ex9-Backup1" width="1000">
</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex9-Backup2.png" alt="Ex9-Backup2" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="6">
<li>
Stop the Neo4j instance.
</li>
<li>
Corrupt the database like you did earlier in this module. Modify the file <strong>movie3.db/neostore.nodestore.db</strong> by adding some text to the file.
</li>
<li>
Run the consistency check tool on <strong>movie3.db</strong> using <code>neo4j-admin</code> specifying <strong>/usr/local/work/reports</strong> as the folder where the report will be written.
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre> neo4j-admin check-consistency --database=movie3.db --report-dir=/usr/local/reports --verbose=true</pre>
</div>
</div>
<!--
data-lang={language} class=
-->
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="9">
<li>
The consistency check tool should return that inconsistencies were found.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex9-Inconsistency.png" alt="Ex9-Inconsistency" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="10">
<li>
Restore the <strong>movie3.db</strong> database from the backup.
</li>
<li>
Check its consistency.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex9-Restore.png" alt="Ex9-Restore" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="11">
<li>
Confirm that the Neo4j instance starts without error.
</li>
</ol>
</div>
</div>
</div>
<div  id="_using_the_import_tool_to_create_a_database" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Using the import tool to create a database</h3>


<div class="paragraph">
<p>The course, <em>Introduction to Neo4j</em>, teaches you how to import <strong>.csv</strong> data using <code>LOAD CSV</code> in Cypher. <code>LOAD CSV</code> works fine for datasets containing fewer than 10M nodes. For large datasets, it may also be possible to import the data with some of the APOC procedures.</p>
</div>


<div class="paragraph">
<p>Data import for a graph database is resource-intensive because it needs to pre-compute joins (relationships) between records (nodes). For large datasets, a best practice is to import the data  using the <code>import</code> command of the <code>neo4j-admin</code> tool. This tool creates the database from a set of <strong>.csv</strong> files.</p>
</div>


<div class="paragraph">
<p>You can read details about using the import tool in the <a href="https://neo4j.com/docs/operations-manual/3.5/tools/import/">Neo4j Operations Manual</a>.</p>
</div>
<div  id="_creating_csv_files_for_the_import" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Creating CSV files for the import</h3>


<div class="paragraph">
<p>The format of the <strong>.csv</strong> files is important. For both nodes and relationships, header information must be associated with the data. Header information contains an ID to uniquely identify the record, optional node labels or relationship types, and names for the properties representing the imported data. A <strong>.csv</strong> can have a header row, or you can place the header information in a separate file.</p>
</div>


<div class="paragraph">
<p>In this training, you will use data that has been created for you that represents crimes.</p>
</div>
<div  id="_csv_files_for_nodes" class="sect3 "  >
<h4>CSV files for nodes</h4>


<div class="paragraph">
<p>Here is portion of the <strong>beats.csv</strong> file with embedded header information for loading nodes of type <em>Beat</em>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>:ID(Beat),id,:LABEL
1132,1132,Beat
0813,0813,Beat
0513,0513,Beat</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>The <strong>beats.csv</strong> records represent data that will be loaded into a node with the label <em>Beat</em>. In this example the record ID is the same as the <em>id</em> property value that will be used to create the node in the graph.</p>
</div>


<div class="paragraph">
<p>Here is an example of the <strong>crimes_header.csv</strong> header file for loading nodes of type <em>Crime</em>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>:ID(Crime),id,:LABEL,date,description</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>The nodes loaded with <strong>Crimes_header.csv</strong> will have the label, <em>:LABEL</em>. In addition, the data in the associated <strong>crimes.csv</strong> file will have values for the ID of the record, and property values for <em>id</em>, <em>date</em>, and <em>description</em>.</p>
</div>


<div class="paragraph">
<p>And here is a portion of the associated <strong>crimes.csv</strong> file for loading nodes of type <em>Crime</em>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>8920441,8920441,Crime,12/07/2012 07:50:00 AM,AUTOMOBILE
4730813,4730813,Crime,05/09/2006 08:20:00 AM,POCKET-PICKING
7150780,7150780,Crime,09/28/2009 01:00:00 AM,CHILD ABANDONMENT
4556970,4556970,Crime,12/16/2005 08:39:24 PM,POSS: CANNABIS 30GMS OR LESS
9442492,9442492,Crime,12/28/2013 12:15:00 PM,OVER $500</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>In addition,  this dataset includes information about the types of crimes. These nodes are created without a label for the node, but their ID, <em>PrimaryType</em> will be used to link them to <em>Crime</em> nodes. Here is a portion of the <strong>primaryTypes.csv</strong> file for loading these nodes:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>:ID(PrimaryType),crimeType
ARSON,ARSON
OBSCENITY,OBSCENITY
ROBBERY,ROBBERY
THEFT,THEFT
CRIM SEXUAL ASSAULT,CRIM SEXUAL ASSAULT
BURGLARY,BURGLARY</pre>
</div>
</div>
<!--
data-lang={language} class=
-->
</div>
<div  id="_csv_files_for_relationships" class="sect3 "  >
<h4>CSV files for relationships</h4>


<div class="paragraph">
<p><strong>.csv</strong> files for loading relationships contain a row for every relationship where the ID for the starting and ending node is specified, as well as the relationship type. If you do not specify the relationship in the file, then you must specify it in the arguments to the import tool.</p>
</div>


<div class="paragraph">
<p>Here is a portion of the <strong>crimesBeats.csv</strong> file that will be used to create the <em>:ON_BEAT</em> relationships between <em>Crime</em> and <em>Beat</em> nodes:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>:START_ID(Crime),:END_ID(Beat),:TYPE
6978096,0911,ON_BEAT
3170923,2511,ON_BEAT
3073515,1012,ON_BEAT
8157905,0113,ON_BEAT</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>Here is a portion of a portion of the <strong>crimesPrimaryTypes.csv</strong> file that will be used to create the  relationships between the <em>Crime</em> nodes and the nodes that contain the <em>CrimeType</em> data:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>:START_ID(Crime),:END_ID(PrimaryType)
5221115,NARCOTICS
4522835,DECEPTIVE PRACTICE
3432518,BATTERY
6439993,CRIMINAL TRESPASS</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>The relationship, <em>:TYPE</em> is not specified in this file so it will be specified in the arguments when you load the data from this file.</p>
</div>
</div>
</div>
<div  id="_importing_the_data" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Importing the data</h3>


<div class="paragraph">
<p>After you have created or obtained the <strong>.csv</strong> files for the data, you import the data. The data import creates a database and you must run the import tool with the Neo4j instance stopped.</p>
</div>


<div class="paragraph">
<p>Here is the simplified syntax for creating a database from <strong>.csv</strong> files:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>neo4j-admin import  --database &lt;database-name&gt;
                    --nodes[:Label1:Label2] [&lt;rheader-csv-file-1&gt;,]&lt;csv-file-1&gt;
					--nodes[:Label1:Label2] [&lt;rheader-csv-file-2&gt;,]&lt;csv-file-2&gt;
					--nodes[:Label1:Label2] [&lt;rheader-csv-file-n&gt;,]&lt;csv-file-n&gt;
					--relationships[:REL_TYPE] [&lt;jheader-csv-file-1&gt;,]&lt;join-csv-file-1&gt;
					--relationships[:REL_TYPE] [&lt;jheader-csv-file-2&gt;,]&lt;join-csv-file-2&gt;
					--relationships[:REL_TYPE] [&lt;jheader-csv-file-n&gt;,]&lt;join-csv-file-n&gt;
					--report-file &lt;report-file-path&gt;</pre>
</div>
</div>
<!--
data-lang={language} class=
-->


<div class="paragraph">
<p>Here is the result of using the <code>import</code> command of <code>neo4j-admin</code> to create a database and import <strong>.csv</strong> files.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Import2.png" alt="Import2" width="1000">
</p>
</div>
</div>
<div  id="_exercise_10_importing_data_with_the_import_command" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #10: Importing data with the import command</strong></h3>


<div class="paragraph">
<p>In this Exercise, you create a new database by importing data using <strong>.csv</strong> files. Data import is very common when preparing a database for production where the data originally comes from relational tables.</p>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Stop the Neo4j instance.
</li>
<li>
In a terminal window, create the <strong>/usr/local/import</strong> folder.
</li>
<li>
Navigate to the <strong>import</strong> folder and download this file: <a href="https://s3-us-west-1.amazonaws.com/data.neo4j.com/admin-neo4j/crime-data.zip" class="bare">https://s3-us-west-1.amazonaws.com/data.neo4j.com/admin-neo4j/crime-data.zip</a>. <strong>Hint</strong>: use <code>curl -O</code> or <code>wget</code>.
</li>
<li>
Unzip the file. You should have six <strong>.csv</strong> files.
</li>
<li>
Examine the contents of the files to become familiar with their format and data.
</li>
<li>
Use the <code>import</code> command to import the data into a new database named <strong>crimes.db</strong>, using these guidelines:
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>--nodes crimes_header.csv,crimes.csv
--nodes beats.csv
--nodes primaryTypes.csv
--relationships crimesBeats.csv
--relationships:PRIMARY_TYPE crimesPrimaryTypes.csv</pre>
</div>
</div>
<!--
data-lang={language} class=
-->
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex10-Import1.png" alt="Ex10-Import1" width="1000">
</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex10-Import2.png" alt="Ex10-Import2" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="7">
<li>
Modify the <strong>neo4j.conf</strong> file to use <strong>crimes.db</strong> as the active database.
</li>
<li>
Ensure that the ownership of the <strong>crimes.db</strong> directory and everything under it is owned by <em>neo4j:neo4j</em>.
</li>
<li>
Start the Neo4j instance.
</li>
<li>
Run <code>cypher-shell</code> to retrieve the schema of the database and also count the number of <em>Crime</em> nodes in the graph.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L03-Ex10-QueryCrimesDB.png" alt="Ex10-QueryCrimesDB" width="1000">
</p>
</div>
</div>
</div>
<div  id="module-3" class="sect1 quiz columns medium-12" style='padding-left: 0;' >
<h3>Check your understanding</h3>
<div  id="_question_1" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 1</h3>


<div class="paragraph">
<p>Suppose that you have installed Neo4j Enterprise Edition and have modified the name of the active database in the Neo4j configuration file. What tool and command do you run to create the new database?</p>
</div>


<div class="paragraph">
<p>Select the correct answer.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer"><code>neo4j-admin create-database</code></span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer"><code>neo4j-admin initialize</code></span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer"><code>neo4j create-database</code></span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer"><code>neo4j start</code></span>
</li>
</ul>
</div>
</div>
<div  id="_question_2" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 2</h3>


<div class="paragraph">
<p>Suppose that you want the existing Neo4j database to have the name <strong>ABCRecommendations.db</strong>. Assuming that you have stopped the Neo4j instance, what steps must you perform to modify the name of the database, which currently has a default name of <strong>graph.db</strong>?</p>
</div>


<div class="paragraph">
<p>Select the correct answers.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Rename the <strong>NEO4J_HOME/graph.db</strong> folder to <strong>NEO4J_HOME/ABCRecommendations.db</strong>.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Modify <strong>neo4j.conf</strong> to use <em>dbms.active_database=ABCRecommendations.db</em>.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">Run <code>neo4j-admin rename graph.db ABCRecommendations.db</code>.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">Run <code>neo4j-admin move graph.db ABCRecommendations.db</code>.</span>
</li>
</ul>
</div>
</div>
<div  id="_question_3" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 3</h3>


<div class="paragraph">
<p>How do you copy a database that you want to give to another user?</p>
</div>


<div class="paragraph">
<p>Select the correct answer.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">With the Neo4j instance started, run <code>neo4j-admin copy</code> providing the location where the copy will be created.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">With the Neo4j instance stopped, run <code>neo4j-admin copy</code> providing the location where the copy will be created.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">With the Neo4j instance started, run <code>neo4j-admin dump</code> providing the location where the dump file will be created.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">With the Neo4j instance stopped, run <code>neo4j-admin dump</code> providing the location where the dump file will be created.</span>
</li>
</ul>
</div>
</div>
</div>
<div  id="_summary" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Summary</h3>


<div class="paragraph">
<p>You should now be able to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Start a Neo4j instance.
</li>
<li>
Stop the Neo4j instance.
</li>
<li>
Set the password for the <em>neo4j</em> user.
</li>
<li>
Copy a Neo4j database.
</li>
<li>
Modify the location for a Neo4j database.
</li>
<li>
Check the consistency of a Neo4j database.
</li>
<li>
Create scripts for modifying a Neo4j database.
</li>
<li>
Manage plugins for a Neo4j database.
</li>
<li>
Configure ports used by the Neo4j instance.
</li>
<li>
Perform an online backup of a Neo4j database.
</li>
<li>
Create a database with the import tool.
</li>
</ul>
</div>
</div>
<div  id="_grade_quiz_and_continue" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Grade Quiz and Continue</h3>
<a class="next-section medium button" href="../part-4/">Continue to Module 4</a>
<script>
$( document ).ready(function() {
  Intercom('trackEvent','training-admin-view-part3');
});
</script>
</div>
</div>
<div id="sidebar-wrapper">
        
        <div id="toc" class="toc2">
        <div id="toctitle">Module: Managing a Neo4j Database</div>
        <ul class="sectlevel1">
<li><a href="#_about_this_module">About this module</a></li>
<li><a href="#_neo4j_instance_files">Neo4j instance files</a></li>
<li><a href="#_post_installation_preparation">Post-installation preparation</a>
<ul class="sectlevel2">
<li><a href="#_post_install_changing_the_neo4j_password_non_debian">Post-install: Changing the <em>neo4j</em> password (non-Debian)</a></li>
<li><a href="#_post_install_debian">Post-install: Debian</a></li>
</ul>
</li>
<li><a href="#_managing_the_neo4j_instance">Managing the Neo4j instance</a>
<ul class="sectlevel2">
<li><a href="#_checking_the_status_of_the_instance">Checking the status of the instance</a></li>
<li><a href="#_viewing_the_neo4j_log">Viewing the neo4j log</a></li>
<li><a href="#_exercise_1_managing_the_neo4j_instance"><strong>Exercise #1: Managing the Neo4j instance</strong></a></li>
</ul>
</li>
<li><a href="#_using_cypher_shell">Using <code>cypher-shell</code></a>
<ul class="sectlevel2">
<li><a href="#_example_using_cypher_shell">Example: Using <code>cypher-shell</code></a></li>
<li><a href="#_changing_the_default_password_debian_only">Changing the default password (Debian only)</a></li>
<li><a href="#_accessing_the_database">Accessing the database</a></li>
<li><a href="#_exercise_2_using_cypher_shell_to_change_the_password"><strong>Exercise #2: Using <code>cypher-shell</code> to change the password</strong></a></li>
</ul>
</li>
<li><a href="#_renaming_a_neo4j_database">Renaming a Neo4j database</a></li>
<li><a href="#_deleting_a_neo4j_database">Deleting a Neo4j database</a></li>
<li><a href="#_copying_a_neo4j_database">Copying a Neo4j database</a>
<ul class="sectlevel2">
<li><a href="#_creating_and_offline_backup">Creating and offline backup</a></li>
<li><a href="#_creating_a_database_from_an_offline_backup">Creating a database from an offline backup</a>
<ul class="sectlevel3">
<li><a href="#_modifying_config_for_new_database">Modifying config for new database</a></li>
</ul>
</li>
<li><a href="#_exercise_3_copying_a_database"><strong>Exercise #3: Copying a database</strong></a></li>
</ul>
</li>
<li><a href="#_modifying_the_location_of_the_database">Modifying the location of the database</a>
<ul class="sectlevel2">
<li><a href="#_starting_neo4j_instance_with_a_new_location">Starting Neo4j instance with a new location</a></li>
<li><a href="#_using_a_different_location_for_the_database">Using a different location for the database</a></li>
<li><a href="#_exercise_4_modifying_the_location_of_the_database"><strong>Exercise #4: Modifying the location of the database</strong></a></li>
</ul>
</li>
<li><a href="#_checking_the_consistency_of_a_database">Checking the consistency of a database</a>
<ul class="sectlevel2">
<li><a href="#_inconsistencies_found">Inconsistencies found</a></li>
<li><a href="#_exercise_5_checking_consistency_of_a_database"><strong>Exercise #5: Checking consistency of a database</strong></a></li>
</ul>
</li>
<li><a href="#_scripting_with_cypher_shell">Scripting with cypher-shell</a>
<ul class="sectlevel2">
<li><a href="#_examples_adding_constraints">Examples: Adding constraints</a></li>
<li><a href="#_exercise_6_scripting_changes_to_the_database"><strong>Exercise #6: Scripting changes to the database</strong></a></li>
</ul>
</li>
<li><a href="#_managing_plugins">Managing plugins</a>
<ul class="sectlevel2">
<li><a href="#_retrieving_available_procedures">Retrieving available procedures</a></li>
<li><a href="#_adding_a_plugin_to_the_neo4j_instance">Adding a plugin to the Neo4j instance</a>
<ul class="sectlevel3">
<li><a href="#_sandboxing_and_whitelisting">Sandboxing and whitelisting</a></li>
</ul>
</li>
<li><a href="#_example_installing_the_graph_algorithms_plugin">Example: Installing the Graph Algorithms plugin</a>
<ul class="sectlevel3">
<li><a href="#_example_download_and_ownership_of_plugin">Example: Download and ownership of plugin</a></li>
<li><a href="#_example_sandboxing">Example: Sandboxing</a></li>
<li><a href="#_example_restart_with_plugin">Example: Restart with plugin</a></li>
</ul>
</li>
<li><a href="#_example_installing_the_apoc_plugin">Example: Installing the APOC plugin</a>
<ul class="sectlevel3">
<li><a href="#_example_download_and_ownership_of_plugin_2">Example: Download and ownership of plugin</a></li>
<li><a href="#_example_sandboxing_2">Example: Sandboxing</a></li>
<li><a href="#_example_restart_with_plugin_2">Example: Restart with plugin</a></li>
</ul>
</li>
<li><a href="#_exercise_7_install_a_plugin"><strong>Exercise #7: Install a plugin</strong></a></li>
</ul>
</li>
<li><a href="#_configuring_connector_ports_for_the_neo4j_instance">Configuring connector ports for the Neo4j instance</a>
<ul class="sectlevel2">
<li><a href="#_modifying_the_default_connector_ports">Modifying the default connector ports</a></li>
<li><a href="#_exercise_8_modify_the_http_port"><strong>Exercise #8: Modify the HTTP port</strong></a></li>
</ul>
</li>
<li><a href="#_performing_online_backup_and_restore">Performing online backup and restore</a>
<ul class="sectlevel2">
<li><a href="#_enabling_online_backup">Enabling online backup</a></li>
<li><a href="#_performing_the_backup">Performing the backup</a></li>
<li><a href="#_restoring_from_a_backup">Restoring from a backup</a></li>
<li><a href="#_exercise_9_performing_online_backup_and_restore"><strong>Exercise #9: Performing online backup and restore</strong></a></li>
</ul>
</li>
<li><a href="#_using_the_import_tool_to_create_a_database">Using the import tool to create a database</a>
<ul class="sectlevel2">
<li><a href="#_creating_csv_files_for_the_import">Creating CSV files for the import</a>
<ul class="sectlevel3">
<li><a href="#_csv_files_for_nodes">CSV files for nodes</a></li>
<li><a href="#_csv_files_for_relationships">CSV files for relationships</a></li>
</ul>
</li>
<li><a href="#_importing_the_data">Importing the data</a></li>
<li><a href="#_exercise_10_importing_data_with_the_import_command"><strong>Exercise #10: Importing data with the import command</strong></a></li>
</ul>
</li>
<li><a href="#module-3">Check your understanding</a>
<ul class="sectlevel2">
<li><a href="#_question_1">Question 1</a></li>
<li><a href="#_question_2">Question 2</a></li>
<li><a href="#_question_3">Question 3</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
<li><a href="#_grade_quiz_and_continue">Grade Quiz and Continue</a></li>
</ul>
        </div>
<div id="progress" style="position:absolute; bottom:100;"></div>
</div>
<script src="https://cdn.auth0.com/js/auth0/9.11/auth0.min.js"></script>
<script src="https://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
<script src="http://s3.amazonaws.com/dev.assets.neo4j.com/wp-content/js/jwt-decode.min.js"></script>
<script src="" type="text/javascript"></script>
<link rel='stylesheet' id='neo-codemirror-css' href="https://neo4j.com/wp-content/themes/neo4jweb/assets/css/codemirror-neo.css?ver=4.5" type='text/css' media='screen'/>
<script src="https://cdn.neo4jlabs.com/graphacademy/prod/course.js?versionId=EUVJ3cAats.snz5EUW2UAOnT5O8rK179" type="text/javascript"></script>